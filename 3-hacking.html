<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hacking nvf</title>
    <style>
      /* Critical CSS to prevent sidebar flash */
      body.sidebar-collapsed .sidebar {
        transform: translateX(-100%);
      }

      body.sidebar-collapsed .sidebar-toggle {
        left: 0;
      }

      body.sidebar-collapsed .sidebar-toggle svg {
        transform: rotate(180deg);
      }
    </style>
    <script>
      // Apply sidebar state immediately before any DOM rendering
      (function() {
        if (localStorage.getItem("sidebar-collapsed") === "true") {
          document.documentElement.classList.add("sidebar-collapsed");
          document.body.classList.add("sidebar-collapsed");
        }
      })();
    </script>
    <link rel="stylesheet" href="assets/style.css" />
    
    <script defer src="assets/search.js"></script>
    
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-left">
          <h1 class="site-title"><a href="index.html">nvf</a></h1>
        </div>
        <nav class="header-nav">
          <ul>
            <li ><a href="options.html">Options</a></li>
            
            <li><a href="search.html">Search</a></li>
            
          </ul>
        </nav>
        
        <div class="search-container">
          <input type="text" id="search-input" placeholder="Search..." />
          <div id="search-results" class="search-results"></div>
        </div>
        
      </header>

      <div class="layout">
        <div class="sidebar-toggle" aria-label="Toggle sidebar">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="24"
            height="24"
          >
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
          </svg>
        </div>
        <nav class="sidebar">
          <div class="docs-nav">
            <h2>Documents</h2>
            <ul>
              <li><a href="3-hacking.html">Hacking nvf</a></li>
<li><a href="2-quirks.html">Known Issues and Quirks</a></li>
<li><a href="4-release-notes.html">Release Notes</a></li>
<li><a href="1-manual.html">Manual</a></li>
<li><a href="search.html">Search</a></li>

            </ul>
          </div>

          <div class="toc">
            <h2>Contents</h2>
            <ul class="toc-list">
              <li><a href="#ch-hacking">Hacking nvf</a>
<ul><li><a href="#sec-contrib-getting-started">Getting Started</a>
<li><a href="#sec-guidelines">Guidelines</a>
<ul><li><a href="#sec-guidelines-documentation">Adding Documentation</a>
<li><a href="#sec-guidelines-formatting">Formatting Code</a>
<li><a href="#sec-guidelines-commit-message-style">Formatting Commits</a>
<li><a href="#sec-guidelines-commit-style">Commit Style</a>
<li><a href="#sec-guidelines-ex-commit-message">Example Commit</a>
</ul></ul><li><a href="#parent-modules-should-always-be-unfolded">parent modules should always be unfolded</a>
<li><a href="#which-means-module-value-instead-of-module-value">which means module = { value = ... } instead of module.value = { ... }</a>
<li><a href="#this-is-ok">this is ok</a>
<li><a href="#this-is-not-ok">this is not ok</a>
<li><a href="#this-is-ok">this is ok</a>
<li><a href="#this-is-also-ok-if-the-list-is-expected-to-contain-more-elements">this is also ok if the list is expected to contain more elements</a>
<li><a href="#plugindefinition-nix">plugindefinition.nix</a>
<li><a href="#config-nix">config.nix</a>
<li><a href="#in-modules-your-plugin-your-plugin-nix">in modules/.../your-plugin/your-plugin.nix</a>
<li><a href="#in-modules-your-plugin-config-nix">in modules/.../your-plugin/config.nix</a>
<li><a href="#in-user-s-config">in user's config</a>
<li><a href="#in-modules-your-plugin-config-nix">in modules/.../your-plugin/config.nix</a>
</li>
            </ul>
          </div>
        </nav>

        <main class="content">
          <h1 id="ch-hacking">Hacking nvf</h1>
<p>nvf is designed for the developer as much as it is designed for the end-user. We
would like for any contributor to be able to propagate their changes, or add new
features to the project with minimum possible friction. As such, below are the
guides and guidelines written to streamline the contribution process and to
ensure that your valuable input integrates into nvf's development as seamlessly
as possible without leaving any question marks in your head.</p>
<p>This section is directed mainly towards those who wish to contribute code into
the project. If you instead wish to report a bug, or discuss a potential new
feature implementation (which you do not wish to implement yourself) first look
among the already <a href="https://github.com/notashelf/nvf/issues">open issues</a> and if no matching issue exists you may open a
<a href="https://github.com/notashelf/nvf/issues/new">new issue</a> and describe your problem/request.</p>
<p>While creating an issue, please try to include as much information as you can,
ideally also include relevant context in which an issue occurs or a feature
should be implemented. If you wish to make a contribution, but feel stuck -
please do not be afraid to submit a pull request, we will help you get it in.</p>
<h2 id="sec-contrib-getting-started">Getting Started</h2>
<p>You, naturally, would like to start by forking the repository to get started. If
you are new to Git and GitHub, do have a look at GitHub's
<a href="https://help.github.com/articles/fork-a-repo/">Fork a repo guide</a> for
instructions on how you can do this. Once you have a fork of <strong>nvf</strong>, you should
create a separate branch based on the most recent <code>main</code> branch. Give your
branch a reasonably descriptive name (e.g. <code>feature/debugger</code> or
<code>fix/pesky-bug</code>) and you are ready to work on your changes</p>
<p>Implement your changes and commit them to the newly created branch and when you
are happy with the result, and positive that it fulfills our
<a href="#sec-guidelines">Contributing Guidelines</a>, push the branch to GitHub and
<a href="https://help.github.com/articles/creating-a-pull-request">create a pull request</a>.
The default pull request template available on the <strong>nvf</strong> repository will guide
you through the rest of the process, and we'll gently nudge you in the correct
direction if there are any mistakes.</p>
<h2 id="sec-guidelines">Guidelines</h2>
<p>If your contribution tightly follows the guidelines, then there is a good chance
it will be merged without too much trouble. Some of the guidelines will be
strictly enforced, others will remain as gentle nudges towards the correct
direction. As we have no automated system enforcing those guidelines, please try
to double check your changes before making your pull request in order to avoid
"faulty" code slipping by.</p>
<p>If you are uncertain how these rules affect the change you would like to make
then feel free to start a discussion in the
<a href="https://github.com/NotAShelf/nvf/discussions">discussions tab</a> ideally (but not
necessarily) before you start developing.</p>
<h3 id="sec-guidelines-documentation">Adding Documentation</h3>
<p>Almost all changes warrant updates to the documentation: at the very least, you
must update the changelog. Both the manual and module options use
<a href="https://github.com/NixOS/nixpkgs/blob/master/doc/README.md#syntax">Nixpkgs Flavoured Markdown</a>.</p>
<p>The HTML version of this manual containing both the module option descriptions
and the documentation of <strong>nvf</strong> (such as this page) can be generated and opened
by typing the following in a shell within a clone of the <strong>nvf</strong> Git repository:</p>
<pre style="background-color:#ffffff;">
<span style="color:#323232;">$ nix build .#docs-html
</span><span style="color:#323232;">$ xdg-open $PWD/result/share/doc/nvf/index.html
</span></pre>
<h3 id="sec-guidelines-formatting">Formatting Code</h3>
<p>Make sure your code is formatted as described in
<a href="#sec-guidelines-code-style">code-style section</a>. To maintain consistency
throughout the project you are encouraged to browse through existing code and
adopt its style also in new code.</p>
<h3 id="sec-guidelines-commit-message-style">Formatting Commits</h3>
<p>Similar to <a href="#sec-guidelines-code-style">code style guidelines</a> we encourage a
consistent commit message format as described in
<a href="#sec-guidelines-commit-style">commit style guidelines</a>.</p>
<h3 id="sec-guidelines-commit-style">Commit Style</h3>
<p>The commits in your pull request should be reasonably self-contained. Which
means each and every commit in a pull request should make sense both on its own
and in general context. That is, a second commit should not resolve an issue
that is introduced in an earlier commit. In particular, you will be asked to
amend any commit that introduces syntax errors or similar problems even if they
are fixed in a later commit.</p>
<p>The commit messages should follow the
<a href="https://chris.beams.io/posts/git-commit/#seven-rule">seven rules</a>, except for
"Capitalize the subject line". We also ask you to include the affected code
component or module in the first line. A commit message ideally, but not
necessarily, follow the given template from home-manager's own documentation</p>
<pre><code>  {component}: {description}

  {long description}
</code></pre><p>where <code>&lt;span class="component-markup"&gt; refers to the code component (or module) your change affects, &lt;/span&gt;&lt;span class="description-markup"&gt; is a very brief description of your change, and &lt;/span&gt;{long description}</code> is an optional clarifying description. As a rare exception,
if there is no clear component, or your change affects many components, then the
`<span class="component-markup"> part is optional. See
<a href="#sec-guidelines-ex-commit-message">example commit message</a> for a commit message
that fulfills these requirements.</p>
<h3 id="sec-guidelines-ex-commit-message">Example Commit</h3>
<p>The commit
<a href="https://github.com/nix-community/home-manager/commit/69f8e47e9e74c8d3d060ca22e18246b7f7d988ef">69f8e47e9e74c8d3d060ca22e18246b7f7d988ef</a>
in home-manager contains the following commit message.</p>
<p></span>``
starship: allow running in Emacs if vterm is used</p>
<p>The vterm buffer is backed by libvterm and can handle Starship prompts
without issues.</p>
<pre><code>
Similarly, if you are contributing to **nvf**, you would include the scope of
the commit followed by the description:

</code></pre><p>languages/ruby: init module</p>
<p>Adds a language module for Ruby, adds appropriate formatters and Treesitter grammars</p>
<pre><code>
Long description can be omitted if the change is too simple to warrant it. A
minor fix in spelling or a formatting change does not warrant long description,
however, a module addition or removal does as you would like to provide the
relevant context, i.e. the reasoning behind it, for your commit.

Finally, when adding a new module, say `modules/foo.nix`, we use the fixed
commit format `foo: add module`. You can, of course, still include a long
description if you wish.

In case of nested modules, i.e `modules/languages/java.nix` you are recommended
to contain the parent as well - for example `languages/java: some major change`.

### Code Style {#sec-guidelines-code-style}

#### Treewide {#sec-code-style-treewide}

Keep lines at a reasonable width, ideally 80 characters or less. This also
applies to string literals and module descriptions and documentation.

#### Nix {#sec-code-style-nix}

[alejandra]: <a href="https://github.com/kamadorueda/alejandra">https://github.com/kamadorueda/alejandra</a>

**nvf** is formatted by the [alejandra] tool and the formatting is checked in
the pull request and push workflows. Run the `nix fmt` command inside the
project repository before submitting your pull request.

While Alejandra is mostly opinionated on how code looks after formatting,
certain changes are done at the user&#39;s discretion based on how the original code
was structured.

Please use one line code for attribute sets that contain only one subset. For
example:

```nix
# parent modules should always be unfolded
# which means module = { value = ... } instead of module.value = { ... }
module = {
  value = mkEnableOption &quot;some description&quot; // { default = true; }; # merges can be done inline where possible

    # same as parent modules, unfold submodules
    subModule = {
        # this is an option that contains more than one nested value
        # Note: try to be careful about the ordering of `mkOption` arguments.
        # General rule of thumb is to order from least to most likely to change.
        # This is, for most cases, type &lt; default &lt; description.
        # Example, if present, would be between default and description
        someOtherValue = mkOption {
            type = lib.types.bool;
            default = true;
            description = &quot;Some other description&quot;;
        };
    };
}
</code></pre><p>If you move a line down after the merge operator, Alejandra will automatically
unfold the whole merged attrset for you, which we <strong>do not</strong> want.</p>
<pre style="background-color:#ffffff;">
<span style="color:#323232;">module </span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">=</span><span style="color:#323232;"> {
</span><span style="color:#323232;">  </span><span style="color:#795da3;">key </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkEnableOption </span><span style="color:#183691;">&quot;some description&quot; </span><span style="font-weight:bold;color:#a71d5d;">// </span><span style="color:#323232;">{
</span><span style="color:#323232;">    </span><span style="color:#795da3;">default </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">true</span><span style="color:#323232;">; </span><span style="font-style:italic;color:#969896;"># we want this to be inline
</span><span style="color:#323232;">  }; </span><span style="font-style:italic;color:#969896;"># ...
</span><span style="color:#323232;">}
</span></pre>
<p>For lists, it is mostly up to your own discretion how you want to format them,
but please try to unfold lists if they contain multiple items and especially if
they are to include comments.</p>
<pre style="background-color:#ffffff;">
<span style="font-style:italic;color:#969896;"># this is ok
</span><span style="color:#323232;">acceptableList </span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">=</span><span style="color:#323232;"> [
</span><span style="color:#323232;">  item1 </span><span style="font-style:italic;color:#969896;"># comment
</span><span style="color:#323232;">  item2
</span><span style="color:#323232;">  item3 </span><span style="font-style:italic;color:#969896;"># some other comment
</span><span style="color:#323232;">  item4
</span><span style="color:#323232;">]</span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">;</span><span style="color:#323232;">
</span><span style="color:#323232;">
</span><span style="font-style:italic;color:#969896;"># this is not ok
</span><span style="color:#323232;">listToBeAvoided </span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">=</span><span style="color:#323232;"> [item1 item2 </span><span style="font-style:italic;color:#969896;">/* comment */ </span><span style="color:#323232;">item3 item4]</span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">;</span><span style="color:#323232;">
</span><span style="color:#323232;">
</span><span style="font-style:italic;color:#969896;"># this is ok
</span><span style="color:#323232;">acceptableList </span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">=</span><span style="color:#323232;"> [item1 item2]</span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">;</span><span style="color:#323232;">
</span><span style="color:#323232;">
</span><span style="font-style:italic;color:#969896;"># this is also ok if the list is expected to contain more elements
</span><span style="color:#323232;">acceptableList</span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">=</span><span style="color:#323232;"> [
</span><span style="color:#323232;">  item1
</span><span style="color:#323232;">  item2
</span><span style="color:#323232;">  </span><span style="font-style:italic;color:#969896;"># more items if needed...
</span><span style="color:#323232;">]</span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">;</span><span style="color:#323232;">
</span></pre>
<h2 id="sec-testing-changes">Testing Changes</h2>
<p>Once you have made your changes, you will need to test them thoroughly. If it is
a module, add your module option to <a href="options.html#option-configuration-nix" class="option-reference"><code>configuration.nix</code></a> (located in the root of
this project) inside <code>neovimConfiguration</code>. Enable it, and then run the maximal
configuration with <code>nix run .#maximal -Lv</code> to check for build errors. If neovim
opens in the current directory without any error messages (you can check the
output of <code>:messages</code> inside neovim to see if there are any errors), then your
changes are good to go. Open your pull request, and it will be reviewed as soon
as possible.</p>
<p>If it is not a new module, but a change to an existing one, then make sure the
module you have changed is enabled in the maximal configuration by editing
<a href="options.html#option-configuration-nix" class="option-reference"><code>configuration.nix</code></a>, and then run it with <code>nix run .#maximal -Lv</code>. Same
procedure as adding a new module will apply here.</p>
<h2 id="sec-keybinds">Keybinds</h2>
<p>As of 0.4, there exists an API for writing your own keybinds and a couple of
useful utility functions are available in the
<a href="https://github.com/NotAShelf/nvf/tree/main/lib">extended standard library</a>. The
following section contains a general overview to how you may utilize said
functions.</p>
<h3 id="sec-custom-key-mappings">Custom Key Mappings Support for a Plugin</h3>
<p>To set a mapping, you should define it in <a href="options.html#option-vim-keymaps" class="option-reference"><code>vim.keymaps</code></a>.</p>
<p>An example, simple keybinding, can look like this:</p>
<pre style="background-color:#ffffff;">
<span style="color:#323232;">{
</span><span style="color:#323232;">  </span><span style="color:#795da3;">vim</span><span style="color:#323232;">.</span><span style="color:#795da3;">keymaps </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[
</span><span style="color:#323232;">    {
</span><span style="color:#323232;">      </span><span style="color:#795da3;">key </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#183691;">&quot;&lt;leader&gt;wq&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">      </span><span style="color:#795da3;">mode </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[</span><span style="color:#183691;">&quot;n&quot;</span><span style="color:#323232;">];
</span><span style="color:#323232;">      </span><span style="color:#795da3;">action </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#183691;">&quot;:wq&lt;CR&gt;&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">      </span><span style="color:#795da3;">silent </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">true</span><span style="color:#323232;">;
</span><span style="color:#323232;">      </span><span style="color:#795da3;">desc </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#183691;">&quot;Save file and quit&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">    }
</span><span style="color:#323232;">  ];
</span><span style="color:#323232;">}
</span></pre>
<p>There are many settings available in the options. Please refer to the
<a href="https://notashelf.github.io/nvf/options.html#opt-vim.keymaps">documentation</a> to
see a list of them.</p>
<p><strong>nvf</strong> provides a helper function, so that you don't have to write the mapping
attribute sets every time:</p>
<ul>
<li><code>mkKeymap</code>, which mimics neovim's <a href="options.html#option-vim-keymap-set" class="option-reference"><code>vim.keymap.set</code></a> function</li>
</ul>
<p>You can read the source code of some modules to see them in action, but the
usage should look something like this:</p>
<pre style="background-color:#ffffff;">
<span style="font-style:italic;color:#969896;"># plugindefinition.nix
</span><span style="color:#323232;">{lib</span><span style="font-weight:bold;color:#a71d5d;">, ...</span><span style="color:#323232;">}: </span><span style="font-weight:bold;color:#a71d5d;">let
</span><span style="color:#323232;">  </span><span style="font-weight:bold;color:#a71d5d;">inherit </span><span style="color:#323232;">(lib</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">options) </span><span style="color:#795da3;">mkEnableOption</span><span style="color:#323232;">;
</span><span style="color:#323232;">  </span><span style="font-weight:bold;color:#a71d5d;">inherit </span><span style="color:#323232;">(lib</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">nvim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">binds) </span><span style="color:#795da3;">mkMappingOption</span><span style="color:#323232;">;
</span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#323232;">{
</span><span style="color:#323232;">  </span><span style="color:#795da3;">options</span><span style="color:#323232;">.</span><span style="color:#795da3;">vim</span><span style="color:#323232;">.</span><span style="color:#795da3;">plugin </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">{
</span><span style="color:#323232;">    </span><span style="color:#795da3;">enable </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkEnableOption </span><span style="color:#183691;">&quot;Enable plugin&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">
</span><span style="color:#323232;">    </span><span style="font-style:italic;color:#969896;"># Mappings should always be inside an attrset called mappings
</span><span style="color:#323232;">    </span><span style="color:#795da3;">mappings </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">{
</span><span style="color:#323232;">      </span><span style="color:#795da3;">workspaceDiagnostics </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkMappingOption </span><span style="color:#183691;">&quot;Workspace diagnostics [trouble]&quot; &quot;&lt;leader&gt;lwd&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">      </span><span style="color:#795da3;">documentDiagnostics </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkMappingOption </span><span style="color:#183691;">&quot;Document diagnostics [trouble]&quot; &quot;&lt;leader&gt;ld&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">      </span><span style="color:#795da3;">lspReferences </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkMappingOption </span><span style="color:#183691;">&quot;LSP References [trouble]&quot; &quot;&lt;leader&gt;lr&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">      </span><span style="color:#795da3;">quickfix </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkMappingOption </span><span style="color:#183691;">&quot;QuickFix [trouble]&quot; &quot;&lt;leader&gt;xq&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">      </span><span style="color:#795da3;">locList </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkMappingOption </span><span style="color:#183691;">&quot;LOCList [trouble]&quot; &quot;&lt;leader&gt;xl&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">      </span><span style="color:#795da3;">symbols </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkMappingOption </span><span style="color:#183691;">&quot;Symbols [trouble]&quot; &quot;&lt;leader&gt;xs&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">    };
</span><span style="color:#323232;">}
</span></pre>
<pre style="background-color:#ffffff;">
<span style="font-style:italic;color:#969896;"># config.nix
</span><span style="color:#323232;">{
</span><span style="color:#323232;">  config</span><span style="font-weight:bold;color:#a71d5d;">,
</span><span style="color:#323232;">  lib</span><span style="font-weight:bold;color:#a71d5d;">,
</span><span style="color:#323232;">  options</span><span style="font-weight:bold;color:#a71d5d;">,
</span><span style="color:#323232;">  </span><span style="font-weight:bold;color:#a71d5d;">...
</span><span style="color:#323232;">}: </span><span style="font-weight:bold;color:#a71d5d;">let
</span><span style="color:#323232;">  </span><span style="font-weight:bold;color:#a71d5d;">inherit </span><span style="color:#323232;">(lib</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">modules) </span><span style="color:#795da3;">mkIf</span><span style="color:#323232;">;
</span><span style="color:#323232;">  </span><span style="font-weight:bold;color:#a71d5d;">inherit </span><span style="color:#323232;">(lib</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">nvim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">binds) </span><span style="color:#795da3;">mkKeymap</span><span style="color:#323232;">;
</span><span style="color:#323232;">
</span><span style="color:#323232;">  </span><span style="color:#795da3;">cfg </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">config</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">vim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">plugin;
</span><span style="color:#323232;">
</span><span style="color:#323232;">  </span><span style="color:#795da3;">keys </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">cfg</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">mappings;
</span><span style="color:#323232;">  </span><span style="font-weight:bold;color:#a71d5d;">inherit </span><span style="color:#323232;">(options</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">vim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">lsp</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">trouble) </span><span style="color:#795da3;">mappings</span><span style="color:#323232;">;
</span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#323232;">{
</span><span style="color:#323232;">  </span><span style="color:#795da3;">config </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkIf cfg</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">enable {
</span><span style="color:#323232;">    </span><span style="color:#795da3;">vim</span><span style="color:#323232;">.</span><span style="color:#795da3;">keymaps </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[
</span><span style="color:#323232;">      (mkKeymap </span><span style="color:#183691;">&quot;n&quot; </span><span style="color:#323232;">keys</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">workspaceDiagnostics </span><span style="color:#183691;">&quot;&lt;cmd&gt;Trouble toggle diagnostics&lt;CR&gt;&quot; </span><span style="color:#323232;">{</span><span style="color:#795da3;">desc </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mappings</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">workspaceDiagnostics</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">description;})
</span><span style="color:#323232;">      (mkKeymap </span><span style="color:#183691;">&quot;n&quot; </span><span style="color:#323232;">keys</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">documentDiagnostics </span><span style="color:#183691;">&quot;&lt;cmd&gt;Trouble toggle diagnostics filter.buf=0&lt;CR&gt;&quot; </span><span style="color:#323232;">{</span><span style="color:#795da3;">desc </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mappings</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">documentDiagnostics</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">description;})
</span><span style="color:#323232;">      (mkKeymap </span><span style="color:#183691;">&quot;n&quot; </span><span style="color:#323232;">keys</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">lspReferences </span><span style="color:#183691;">&quot;&lt;cmd&gt;Trouble toggle lsp_references&lt;CR&gt;&quot; </span><span style="color:#323232;">{</span><span style="color:#795da3;">desc </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mappings</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">lspReferences</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">description;})
</span><span style="color:#323232;">      (mkKeymap </span><span style="color:#183691;">&quot;n&quot; </span><span style="color:#323232;">keys</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">quickfix </span><span style="color:#183691;">&quot;&lt;cmd&gt;Trouble toggle quickfix&lt;CR&gt;&quot; </span><span style="color:#323232;">{</span><span style="color:#795da3;">desc </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mappings</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">quickfix</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">description;})
</span><span style="color:#323232;">      (mkKeymap </span><span style="color:#183691;">&quot;n&quot; </span><span style="color:#323232;">keys</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">locList </span><span style="color:#183691;">&quot;&lt;cmd&gt;Trouble toggle loclist&lt;CR&gt;&quot; </span><span style="color:#323232;">{</span><span style="color:#795da3;">desc </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mappings</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">locList</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">description;})
</span><span style="color:#323232;">      (mkKeymap </span><span style="color:#183691;">&quot;n&quot; </span><span style="color:#323232;">keys</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">symbols </span><span style="color:#183691;">&quot;&lt;cmd&gt;Trouble toggle symbols&lt;CR&gt;&quot; </span><span style="color:#323232;">{</span><span style="color:#795da3;">desc </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mappings</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">symbols</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">description;})
</span><span style="color:#323232;">    ];
</span><span style="color:#323232;">  };
</span><span style="color:#323232;">}
</span></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have come across a plugin that has an API that doesn’t seem to
easily allow custom keybindings, don’t be scared to implement a draft PR.
We’ll help you get it done.</p>
</div>
<h2 id="sec-additional-plugins">Adding Plugins</h2>
<p>To add a new Neovim plugin, use <code>npins</code></p>
<p>Use:</p>
<p><code>nix-shell -p npins</code> or <code>nix shell nixpkgs#npins</code></p>
<p>Then run:</p>
<p><code>npins add --name &lt;plugin name&gt; github &lt;owner&gt; &lt;repo&gt; -b &lt;branch&gt;</code></p>
<p>Be sure to replace any non-alphanumeric characters with <code>-</code> for <code>--name</code></p>
<p>For example</p>
<p><code>npins add --name lazydev-nvim github folke lazydev.nvim -b main</code></p>
<p>You can now reference this plugin as a <strong>string</strong>.</p>
<pre style="background-color:#ffffff;">
<span style="color:#323232;">config</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">vim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">startPlugins </span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">=</span><span style="color:#323232;"> [</span><span style="color:#183691;">&quot;lazydev-nvim&quot;</span><span style="color:#323232;">]</span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">;</span><span style="color:#323232;">
</span></pre>
<h3 id="sec-modular-setup-options">Modular setup options</h3>
<p>Most plugins is initialized with a call to <code>require('plugin').setup({...})</code>.</p>
<p>We use a special function that lets you easily add support for such setup
options in a modular way: <code>mkPluginSetupOption</code>.</p>
<p>Once you have added the source of the plugin as shown above, you can define the
setup options like this:</p>
<pre style="background-color:#ffffff;">
<span style="font-style:italic;color:#969896;"># in modules/.../your-plugin/your-plugin.nix
</span><span style="color:#323232;">
</span><span style="color:#323232;">{lib</span><span style="font-weight:bold;color:#a71d5d;">, ...</span><span style="color:#323232;">}:
</span><span style="font-weight:bold;color:#a71d5d;">let
</span><span style="color:#323232;">  </span><span style="font-weight:bold;color:#a71d5d;">inherit </span><span style="color:#323232;">(lib</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">types) </span><span style="color:#795da3;">bool int</span><span style="color:#323232;">;
</span><span style="color:#323232;">  </span><span style="font-weight:bold;color:#a71d5d;">inherit </span><span style="color:#323232;">(lib</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">nvim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">types) </span><span style="color:#795da3;">mkPluginSetupOption</span><span style="color:#323232;">;
</span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#323232;">{
</span><span style="color:#323232;">  </span><span style="color:#795da3;">options</span><span style="color:#323232;">.</span><span style="color:#795da3;">vim</span><span style="color:#323232;">.</span><span style="color:#795da3;">your-plugin </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">{
</span><span style="color:#323232;">    </span><span style="color:#795da3;">setupOpts </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkPluginSetupOption </span><span style="color:#183691;">&quot;plugin name&quot; </span><span style="color:#323232;">{
</span><span style="color:#323232;">      </span><span style="color:#795da3;">enable_feature_a </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkOption {
</span><span style="color:#323232;">        </span><span style="color:#795da3;">type </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">bool;
</span><span style="color:#323232;">        </span><span style="color:#795da3;">default </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">false</span><span style="color:#323232;">;
</span><span style="color:#323232;">        </span><span style="font-style:italic;color:#969896;"># ...
</span><span style="color:#323232;">      };
</span><span style="color:#323232;">
</span><span style="color:#323232;">      </span><span style="color:#795da3;">number_option </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">mkOption {
</span><span style="color:#323232;">        </span><span style="color:#795da3;">type </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">int;
</span><span style="color:#323232;">        </span><span style="color:#795da3;">default </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">3</span><span style="color:#323232;">;
</span><span style="color:#323232;">        </span><span style="font-style:italic;color:#969896;"># ...
</span><span style="color:#323232;">      };
</span><span style="color:#323232;">    };
</span><span style="color:#323232;">  };
</span><span style="color:#323232;">}
</span></pre>
<pre style="background-color:#ffffff;">
<span style="font-style:italic;color:#969896;"># in modules/.../your-plugin/config.nix
</span><span style="color:#323232;">{lib</span><span style="font-weight:bold;color:#a71d5d;">, </span><span style="color:#323232;">config</span><span style="font-weight:bold;color:#a71d5d;">, ...</span><span style="color:#323232;">}:
</span><span style="font-weight:bold;color:#a71d5d;">let
</span><span style="color:#323232;">  </span><span style="color:#795da3;">cfg </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">config</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">vim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">your-plugin;
</span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#323232;">{
</span><span style="color:#323232;">  </span><span style="color:#795da3;">vim</span><span style="color:#323232;">.</span><span style="color:#795da3;">luaConfigRC </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">lib</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">nvim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">dag</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">entryAnywhere </span><span style="color:#183691;">&#39;&#39;
</span><span style="color:#183691;">    require(&#39;plugin-name&#39;).setup(${</span><span style="color:#323232;">lib</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">nvim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">lua</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">toLuaObject cfg</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">setupOpts</span><span style="color:#183691;">})
</span><span style="color:#183691;">  &#39;&#39;</span><span style="color:#323232;">;
</span><span style="color:#323232;">}
</span></pre>
<p>This above config will result in this lua script:</p>
<pre style="background-color:#ffffff;">
<span style="color:#62a35c;">require</span><span style="color:#323232;">(</span><span style="color:#183691;">&#39;plugin-name&#39;</span><span style="color:#323232;">).setup({
</span><span style="color:#323232;">  </span><span style="color:#183691;">enable_feature_a </span><span style="color:#323232;">= </span><span style="color:#0086b3;">false</span><span style="color:#323232;">,
</span><span style="color:#323232;">  </span><span style="color:#183691;">number_option </span><span style="color:#323232;">= </span><span style="color:#0086b3;">3</span><span style="color:#323232;">,
</span><span style="color:#323232;">})
</span></pre>
<p>Now users can set any of the pre-defined option field, and can also add their
own fields!</p>
<pre style="background-color:#ffffff;">
<span style="font-style:italic;color:#969896;"># in user&#39;s config
</span><span style="color:#323232;">{
</span><span style="color:#323232;">  </span><span style="color:#795da3;">vim</span><span style="color:#323232;">.</span><span style="color:#795da3;">your-plugin</span><span style="color:#323232;">.</span><span style="color:#795da3;">setupOpts </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">{
</span><span style="color:#323232;">    </span><span style="color:#795da3;">enable_feature_a </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">true</span><span style="color:#323232;">;
</span><span style="color:#323232;">    </span><span style="color:#795da3;">number_option </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">4</span><span style="color:#323232;">;
</span><span style="color:#323232;">    </span><span style="color:#795da3;">another_field </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#183691;">&quot;hello&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">    </span><span style="color:#795da3;">size </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">{ </span><span style="font-style:italic;color:#969896;"># nested fields work as well
</span><span style="color:#323232;">      </span><span style="color:#795da3;">top </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">10</span><span style="color:#323232;">;
</span><span style="color:#323232;">    };
</span><span style="color:#323232;">  };
</span><span style="color:#323232;">}
</span></pre>
<h3 id="sec-details-of-toluaobject">Details of toLuaObject</h3>
<p>As you've seen above, <code>toLuaObject</code> is used to convert our nix attrSet
<a href="options.html#option-cfg-setupOpts" class="option-reference"><code>cfg.setupOpts</code></a>, into a lua table. Here are some rules of the conversion:</p>
<ol>
<li>nix <code>null</code> converts to lua <code>nil</code></li>
<li>number and strings convert to their lua counterparts</li>
<li>nix attrSet/list convert into lua tables</li>
<li>you can write raw lua code using <a href="options.html#option-lib-generators-mkLuaInline" class="option-reference"><code>lib.generators.mkLuaInline</code></a>. This function
is part of nixpkgs.</li>
</ol>
<p>Example:</p>
<pre style="background-color:#ffffff;">
<span style="color:#323232;">vim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">your-plugin</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">setupOpts </span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">=</span><span style="color:#323232;"> {
</span><span style="color:#323232;">  </span><span style="color:#795da3;">on_init </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">lib</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">generators</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">mkLuaInline </span><span style="color:#183691;">&#39;&#39;
</span><span style="color:#183691;">    function()
</span><span style="color:#183691;">      print(&#39;we can write lua!&#39;)
</span><span style="color:#183691;">    end
</span><span style="color:#183691;">  &#39;&#39;</span><span style="color:#323232;">;
</span><span style="color:#323232;">}
</span></pre>
<h3 id="sec-lazy-plugins">Lazy plugins</h3>
<p>If the plugin can be lazy-loaded, <a href="options.html#option-vim-lazy-plugins" class="option-reference"><code>vim.lazy.plugins</code></a> should be used to add it.
Lazy plugins are managed by <a href="options.html#option-lz-n" class="option-reference"><code>lz.n</code></a>.</p>
<pre style="background-color:#ffffff;">
<span style="font-style:italic;color:#969896;"># in modules/.../your-plugin/config.nix
</span><span style="color:#323232;">{lib</span><span style="font-weight:bold;color:#a71d5d;">, </span><span style="color:#323232;">config</span><span style="font-weight:bold;color:#a71d5d;">, ...</span><span style="color:#323232;">}:
</span><span style="font-weight:bold;color:#a71d5d;">let
</span><span style="color:#323232;">  </span><span style="color:#795da3;">cfg </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">config</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">vim</span><span style="font-weight:bold;color:#a71d5d;">.</span><span style="color:#323232;">your-plugin;
</span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#323232;">{
</span><span style="color:#323232;">  </span><span style="color:#795da3;">vim</span><span style="color:#323232;">.</span><span style="color:#795da3;">lazy</span><span style="color:#323232;">.</span><span style="color:#795da3;">plugins</span><span style="color:#323232;">.</span><span style="color:#795da3;">your-plugin </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">{
</span><span style="color:#323232;">    </span><span style="font-style:italic;color:#969896;"># instead of vim.startPlugins, use this:
</span><span style="color:#323232;">    </span><span style="color:#795da3;">package </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#183691;">&quot;your-plugin&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">
</span><span style="color:#323232;">    </span><span style="font-style:italic;color:#969896;"># if your plugin uses the `require(&#39;your-plugin&#39;).setup{...}` pattern
</span><span style="color:#323232;">    </span><span style="color:#795da3;">setupModule </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#183691;">&quot;your-plugin&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">    </span><span style="font-weight:bold;color:#a71d5d;">inherit </span><span style="color:#323232;">(cfg) </span><span style="color:#795da3;">setupOpts</span><span style="color:#323232;">;
</span><span style="color:#323232;">
</span><span style="color:#323232;">    </span><span style="font-style:italic;color:#969896;"># events that trigger this plugin to be loaded
</span><span style="color:#323232;">    </span><span style="color:#795da3;">event </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[</span><span style="color:#183691;">&quot;DirChanged&quot;</span><span style="color:#323232;">];
</span><span style="color:#323232;">    </span><span style="color:#795da3;">cmd </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[</span><span style="color:#183691;">&quot;YourPluginCommand&quot;</span><span style="color:#323232;">];
</span><span style="color:#323232;">
</span><span style="color:#323232;">    </span><span style="font-style:italic;color:#969896;"># keymaps
</span><span style="color:#323232;">    </span><span style="color:#795da3;">keys </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[
</span><span style="color:#323232;">      </span><span style="font-style:italic;color:#969896;"># we&#39;ll cover this in detail in the keymaps section
</span><span style="color:#323232;">      {
</span><span style="color:#323232;">        </span><span style="color:#795da3;">key </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#183691;">&quot;&lt;leader&gt;d&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">        </span><span style="color:#795da3;">mode </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#183691;">&quot;n&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">        </span><span style="color:#795da3;">action </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#183691;">&quot;:YourPluginCommand&quot;</span><span style="color:#323232;">;
</span><span style="color:#323232;">      }
</span><span style="color:#323232;">    ];
</span><span style="color:#323232;">  };
</span><span style="background-color:#f5f5f5;font-weight:bold;color:#b52a1d;">;</span><span style="color:#323232;">
</span><span style="color:#323232;">}
</span></pre>
<p>This results in the following lua code:</p>
<pre style="background-color:#ffffff;">
<span style="color:#62a35c;">require</span><span style="color:#323232;">(</span><span style="color:#183691;">&#39;lz.n&#39;</span><span style="color:#323232;">).load({
</span><span style="color:#323232;">  {
</span><span style="color:#323232;">    </span><span style="color:#183691;">&quot;name-of-your-plugin&quot;</span><span style="color:#323232;">,
</span><span style="color:#323232;">    </span><span style="font-weight:bold;color:#795da3;">after </span><span style="color:#323232;">= </span><span style="font-weight:bold;color:#a71d5d;">function</span><span style="color:#323232;">()
</span><span style="color:#323232;">      </span><span style="color:#62a35c;">require</span><span style="color:#323232;">(</span><span style="color:#183691;">&#39;your-plugin&#39;</span><span style="color:#323232;">).setup({</span><span style="font-style:italic;color:#969896;">--[[ your setupOpts ]]</span><span style="color:#323232;">})
</span><span style="color:#323232;">    </span><span style="font-weight:bold;color:#a71d5d;">end</span><span style="color:#323232;">,
</span><span style="color:#323232;">
</span><span style="color:#323232;">    </span><span style="color:#183691;">event </span><span style="color:#323232;">= {</span><span style="color:#183691;">&quot;DirChanged&quot;</span><span style="color:#323232;">},
</span><span style="color:#323232;">    </span><span style="color:#183691;">cmd </span><span style="color:#323232;">= {</span><span style="color:#183691;">&quot;YourPluginCommand&quot;</span><span style="color:#323232;">},
</span><span style="color:#323232;">    </span><span style="color:#183691;">keys </span><span style="color:#323232;">= {
</span><span style="color:#323232;">      {</span><span style="color:#183691;">&quot;&lt;leader&gt;d&quot;</span><span style="color:#323232;">, </span><span style="color:#183691;">&quot;:YourPluginCommand&quot;</span><span style="color:#323232;">, </span><span style="color:#183691;">mode </span><span style="color:#323232;">= {</span><span style="color:#183691;">&quot;n&quot;</span><span style="color:#323232;">}},
</span><span style="color:#323232;">    },
</span><span style="color:#323232;">  }
</span><span style="color:#323232;">})
</span></pre>
<p>A full list of options can be found
[here](<a href="https://notashelf.github.io/nvf/options.html#opt-vim.lazy.plugins">https://notashelf.github.io/nvf/options.html#opt-vim.lazy.plugins</a></p>

          <div class="footnotes-container">
            <!-- Footnotes will be appended here -->
          </div>
        </main>
      </div>

      <footer>
        <p></p>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Sidebar Toggle functionality
        const toggle = document.querySelector(".sidebar-toggle");

        if (toggle) {
          toggle.addEventListener("click", function () {
            document.body.classList.toggle("sidebar-collapsed");

            // Save state to localStorage
            const isCollapsed = document.body.classList.contains("sidebar-collapsed");
            localStorage.setItem("sidebar-collapsed", isCollapsed);
          });
        }

        // Make headings clickable for anchor links
        const content = document.querySelector(".content");
        const headings = content.querySelectorAll("h1, h2, h3, h4, h5, h6");

        headings.forEach(function (heading) {
          // Make sure all headings have IDs
          if (!heading.id) {
            heading.id = heading.textContent
              .toLowerCase()
              .replace(/[^\w\s-]/g, "")
              .replace(/[\s-]+/g, "-")
              .trim();

            if (!heading.id) {
              heading.id =
                "section-" + Math.random().toString(36).substring(2, 9);
            }
          }

          // Make the entire heading clickable
          heading.addEventListener("click", function (e) {
            const id = this.id;
            history.pushState(null, null, "#" + id);

            // Scroll with offset
            const offset =
              this.getBoundingClientRect().top + window.scrollY - 80;
            window.scrollTo({
              top: offset,
              behavior: "smooth",
            });
          });
        });

        // Process footnotes
        const footnoteContainer = document.querySelector(
          ".footnotes-container",
        );

        // Find all footnote references and create a footnotes section
        const footnoteRefs = content.querySelectorAll('a[href^="#fn"]');
        if (footnoteRefs.length > 0) {
          const footnotesDiv = document.createElement("div");
          footnotesDiv.className = "footnotes";

          const footnotesHeading = document.createElement("h2");
          footnotesHeading.textContent = "Footnotes";
          footnotesDiv.appendChild(footnotesHeading);

          const footnotesList = document.createElement("ol");
          footnoteContainer.appendChild(footnotesDiv);
          footnotesDiv.appendChild(footnotesList);

          // Add footnotes
          document.querySelectorAll(".footnote").forEach((footnote) => {
            const id = footnote.id;
            const content = footnote.innerHTML;

            const li = document.createElement("li");
            li.id = id;
            li.innerHTML = content;

            // Add backlink
            const backlink = document.createElement("a");
            backlink.href = "#fnref:" + id.replace("fn:", "");
            backlink.className = "footnote-backlink";
            backlink.textContent = "↩";
            li.appendChild(backlink);

            footnotesList.appendChild(li);
          });
        }

        // Handle initial hash navigation
        function scrollToElement(element) {
          if (element) {
            const offset =
              element.getBoundingClientRect().top + window.scrollY - 80;
            window.scrollTo({
              top: offset,
              behavior: "smooth",
            });
          }
        }

        if (window.location.hash) {
          const targetElement = document.querySelector(window.location.hash);
          if (targetElement) {
            setTimeout(() => scrollToElement(targetElement), 0);
          }
        }
      });
    </script>
    <script src="assets/search.js"></script>

  </body>
</html>
